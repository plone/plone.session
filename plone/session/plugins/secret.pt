<h1 tal:replace="structure here/manage_page_header">
  PAGE HEADER
</h1>
<h2 tal:replace="structure here/manage_tabs">
  PAGE HEADER
</h2>

<h3>
  Session identifier management</h3>

<div class="form-help">
  <p>
     You may use either a shared secret or the plone.keyring ring of five secrets
        (shared with the plone.protect CSRF protection framework.)
  </p>
  <p>The following properties may be set through the Properties tab:
  </p>
  <dl>
    <dt>Cookie validity timeout (in seconds)</dt>
    <dd>After this, the session is invalid and the user must login again. Set to 0
          for the cookie to remain valid indefinitely. Note that when the user
          folder has caching enabled, cookie validity may not be checked on every
      request.</dd>

    <dt>Use mod_auth_tkt compatible hashing algorithm</dt>
    <dd>Compatibility with other implementations, but at the cost of using a weaker
      hashing algorithm.</dd>

    <dt>Cookie name</dt>
    <dd>Which cookie to use. This must also be set on the
      `credentials_cookie_auth`` plugin.</dd>

    <dt>Cookie lifetime (in days)</dt>
    <dd>This makes the cookie persistent across opening and closing the browser.</dd>

    <dt>Cookie domain</dt>
    <dd>A cookie may be shared across www1.example.com and www2.example.com by
      setting the cookie domain to ``.example.com``. (blank for the user's current domain)</dd>

    <dt>Cookie path</dt>
    <dd>What path the cookie is set valid (defaults to ``/``.)</dd>
  </dl>

</div>

<h3>Shared secret
  <span tal:condition="context/haveSharedSecret">(enabled)</span></h3>

<p>
To enable logins between sites or other mod_auth_tkt systems, set the shared secret.
</p>
<form action="."
      method="post"
      tal:attributes="
        action string:${context/absolute_url};
      "
>

  <label for="shared_secret">Shared secret:</label>
  <input autocomplete="off"
         name="shared_secret"
         size="50"
         type="text"
         value=""
  />
  <input name="manage_setSharedSecret:method"
         type="submit"
         value="Set shared secret"
  /><br />
  <input tal:replace="structure context/@@authenticator/authenticator" />
</form>


<form action="."
      method="post"
      tal:condition="context/haveSharedSecret"
      tal:attributes="
        action string:${context/absolute_url};
      "
>
  <p>
    To use the plone.keyring secrets, remove the shared secret.
  </p>
  <input name="manage_removeSharedSecret:method"
         type="submit"
         value="Remove shared secret"
  />
  <input tal:replace="structure context/@@authenticator/authenticator" />
</form>

<h3>plone.keyring secrets
  <span tal:condition="not:context/haveSharedSecret">(enabled)</span></h3>

<p>
This implementation uses a ring of five secrets: one of them is used to
generate new session identifiers, the others are older signing secrets which
are still considered to be valid.
</p>

<h4>Invalidate all session identifiers</h4>
<p>
By clicking the button below you clear all secrets used to validate sessions.
This will immediately log out all users who use session authentication and
require them to log in again.
</p>
<p tal:condition="context/per_user_keyring">
In addition to the system keyring each user keyring will also be invalidated (since per-user keyrings are enabled).
</p>
<form action="."
      method="post"
      tal:attributes="
        action string:${context/absolute_url};
      "
>
  <input name="manage_clearSecrets:method"
         type="submit"
         value="Clear secrets"
  />
  <input tal:replace="structure context/@@authenticator/authenticator" />
</form>

<h4>Create a new (signing) secret</h4>
<p>
By clicking the button below a new signing secret will be created and added
to the ring. This will remove the oldest secret from the ring if there already
were five secrets present.
</p>
<form action="."
      method="post"
      tal:attributes="
        action string:${context/absolute_url};
      "
>
  <input name="manage_createNewSecret:method"
         type="submit"
         value="New secret"
  />
  <input tal:replace="structure context/@@authenticator/authenticator" />
</form>

<h4>Use per-user keyrings (server-side logout)<span tal:condition="context/per_user_keyring">(enabled)</span></h4>
<p>
By clicking the button below a separate keyring will be created for each user when
they login. The keyring will be cleared and regenerated when the user logs out,
thus invalidating their session cookie, making it impossible to re-use a previous cookie.
Per-user keyrings use a single secret.
</p>
<p>
Users that have an active, valid session will still be able to use it (system keyring) until it expires.
They will then switch to their own keyring when they log in again.
</p>
<form action="."
      method="post"
      tal:attributes="
        action string:${context/absolute_url};
      "
>
  <input name="manage_togglePerUserKeyring:method"
         type="submit"
         tal:attributes="
           value python:test(context.per_user_keyring, 'Disable per-user keyrings', 'Enable per-user keyrings');
         "
  />
  <input tal:replace="structure context/@@authenticator/authenticator" />
</form>


<h1 tal:replace="structure here/manage_page_footer">
  PAGE FOOTER
</h1>
